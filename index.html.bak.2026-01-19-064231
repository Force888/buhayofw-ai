<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BuhayOFW AI</title>
  <link rel="stylesheet" href="/ui.css">
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1 style="margin:0 0 6px 0;">BuhayOFW AI</h1>
      <div class="muted" style="max-width:900px; line-height:1.45;">
        <div><strong>Tagalog-first</strong> AI assistant • simple, clear, and helpful</div>
        <div>Pwede Tagalog o English.</div>
        <div>Health • Legal • Self-help</div>
        <div><strong>Not a doctor/lawyer</strong> — for guidance only.</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <label for="q" class="muted">Ask a question (Tagalog or English):</label>

      <!-- composer -->
      <textarea id="q" placeholder="Halimbawa: Ano ang dapat gawin kapag masakit ang binti habang naglalakad?"></textarea>

      <div class="row">
        <button id="send" class="btn" type="button">Send</button>
        <span id="status" class="muted"></span>
      </div>

      <!-- chat output -->
      <div id="out" class="out" style="margin-top:14px;"></div>

      <div class="muted" style="margin-top:10px;">
        Tip: Press Ctrl+Enter to send. Results may be imperfect—double-check important info.
      </div>
    </div>
  </div>

<script>
  const q = document.getElementById('q');
  const out = document.getElementById('out');
  const sendBtn = document.getElementById('send');
  const statusEl = document.getElementById('status');

  function setStatus(s){ statusEl.textContent = s || ''; }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function addBubble(role, text){
    const div = document.createElement('div');
    div.className = 'bubble ' + role;
    div.innerHTML = escapeHtml(text).replace(/\n/g,'<br>');
    out.appendChild(div);
    out.scrollTop = out.scrollHeight;
  }

  async function ask(){
    const text = (q.value || '').trim();
    if(!text) return;

    // show user bubble and clear composer
    addBubble('user', text);
    q.value = '';

    setStatus('Thinking...');
    sendBtn.disabled = true;

    try{
      const r = await fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: text })
      });

      const data = await r.json();
      const answer = (data && (data.answer || data.text)) ? (data.answer || data.text) : JSON.stringify(data, null, 2);

      addBubble('ai', answer);
      setStatus('');
    }catch(e){
      addBubble('ai', 'Error: ' + (e && e.message ? e.message : e));
      setStatus('');
    }finally{
      sendBtn.disabled = false;
      q.focus();
    }
  }

  sendBtn.addEventListener('click', ask);
  q.addEventListener('keydown', (e) => {
    if(e.ctrlKey && e.key === 'Enter') ask();
  });
</script>
</body>
</html>
